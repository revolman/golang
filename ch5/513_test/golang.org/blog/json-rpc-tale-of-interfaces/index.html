
<!DOCTYPE html>
<html lang="en">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-11222381-3"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag("js", new Date());
gtag("config", "UA-11222381-3");
gtag("config", "UA-49880327-6");
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#00ADD8">
<meta name="description" content="Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.">
<title>JSON-RPC: a tale of interfaces - The Go Blog</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:600|Roboto:400,700|Source+Code+Pro">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Product+Sans&text=Supported%20by%20Google&display=swap">
<link rel="stylesheet" href="/lib/godoc/style.css">
<link rel="stylesheet" href="/fonts.css">
<link rel="alternate" type="application/atom+xml" title="blog.golang.org - Atom Feed" href="https://blog.golang.org/feed.atom" />
<script>window.initFuncs = [];</script>
<style>
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: 'Work Sans', sans-serif;
    font-weight: 600;
  }
  h2 {  
    background: none;
    clear: none;
    font-size: 1.5em;
    font-weight: 600;
    line-height: inherit;
    overflow-wrap: normal;
    padding: 0;
  }
  @media print {
    #sidebar { display: none; }
  }
  #sidebar {
    float: right;
    padding-left: 20px;
    width: 40%;
    max-width: 250px;
    background: #f8f9f9;
    margin: 20px 0 20px 20px;
  }
  #sidebar h2 {
    font-size: 1rem;
  }
  #sidebar ul {
    padding: 0;
  }
  #sidebar li {
    list-style-type: none;
  }
  #content .author {
    font-style: italic;
  }
  #content .article {
    margin-bottom: 50px;
  }
  #content .date {
    color: #6e7072;
  }
  #content .tags {
    color: #999;
    font-size: smaller;
  }
  #content .iframe, #content .image {
    margin: 20px;
  }
  #content .title {
    margin: 20px 0;
  }
  #content img {
    max-width: 100%;
  }
  .article[data-slug='/go-fonts'] {
    font-family: Go, sans-serif;
  }
  .article[data-slug='/go-fonts'] pre,
  .article[data-slug='/go-fonts'] code {
    font-family: 'Go Mono', monospace;
  }
</style>
<body class="Site">
  <header class="Header js-header">
    <nav class="Header-nav">
      <a href="https://golang.org"><img class="Header-logo" src="/lib/godoc/images/go-logo-blue.svg" alt="Go"></a>
      <button class="Header-menuButton js-headerMenuButton" aria-label="Main menu" aria-expanded="false">
        <div class="Header-menuButtonInner">
      </button>
      <ul class="Header-menu">
        <li class="Header-menuItem"><a href="https://golang.org/doc/">Documents</a></li>
        <li class="Header-menuItem"><a href="https://golang.org/pkg/">Packages</a></li>
        <li class="Header-menuItem"><a href="https://golang.org/project/">The Project</a></li>
        <li class="Header-menuItem"><a href="https://golang.org/help/">Help</a></li>
        <li class="Header-menuItem"><a href="/">Blog</a></li>
        <li class="Header-menuItem"><a href="https://play.golang.org/">Play</a></li>
        <li class="Header-menuItem Header-menuItem--search">
          <form class="HeaderSearch" role="search" action="https://golang.org/search">
            <input class="HeaderSearch-input"
                  type="search"
                  name="q"
                  placeholder="Search"
                  aria-label="Search"
                  autocapitalize="off"
                  autocomplete="off"
                  autocorrect="off"
                  spellcheck="false"
                  required>
            <button class="HeaderSearch-submit" aria-label="Search">
              <svg class="HeaderSearch-icon" width="24" height="24" viewBox="0 0 24 24"><title>Search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg>
            </button>
          </form>
        </li>
      </ul>
    </nav>
  </header>

  <main class="Site-content" id="page">
    <div class="container">
      <aside id="sidebar">
        
          
            <h2>Next article</h2>
            <p><a href="/new-talk-and-tutorials">New Talk and Tutorials</a></p>
          

          
            <h2>Previous article</h2>
            <p><a href="/protobuf">Third-party libraries: goprotobuf and beyond</a></p>
          
        

        <h2>Links</h2>
        <ul>
          <li><a href='//golang.org/'>golang.org</a></li>
          <li><a href='//golang.org/doc/install.html'>Install Go</a></li>
          <li><a href='//tour.golang.org/'>A Tour of Go</a></li>
          <li><a href='//golang.org/doc/'>Go Documentation</a></li>
          <li><a href='//groups.google.com/group/golang-nuts'>Go Mailing List</a></li>
          <li><a href='//twitter.com/golang'>Go on Twitter</a></li>
        </ul>

        <p><a href="/index">Blog index</a></p>
      </aside>

      <div id="content">
        <h1><a href="/">The Go Blog</a></h1>
        
	
  <div class="article" data-slug="/json-rpc">
    <h2 class="title"><a href="/json-rpc">JSON-RPC: a tale of interfaces</a></h2>
    <p class="author">
    Andrew Gerrand<br>
    27 April 2010
    </p>
    
  
  
    
      
        <p>Here we present an example where Go's <a href="https://golang.org/doc/effective_go.html#interfaces_and_types" target="_blank" rel="noopener">interfaces</a>
made it easy to refactor some existing code to make it more flexible and extensible.
Originally, the standard library's <a href="https://golang.org/pkg/net/rpc/" target="_blank" rel="noopener">RPC package</a>
used a custom wire format called <a href="https://golang.org/pkg/encoding/gob/" target="_blank" rel="noopener">gob</a>.
For a particular application, we wanted to use <a href="https://golang.org/pkg/encoding/json/" target="_blank" rel="noopener">JSON</a>
as an alternate wire format.</p>
<p>We first defined a pair of interfaces to describe the functionality of the
existing wire format,
one for the client, and one for the server (depicted below).</p>
<pre><code>type ServerCodec interface {
 ReadRequestHeader(*Request) error
 ReadRequestBody(interface{}) error
 WriteResponse(*Response, interface{}) error
 Close() error
}
</code></pre>
<p>On the server side, we then changed two internal function signatures to
accept the <code>ServerCodec</code> interface instead of our existing <code>gob.Encoder</code>. Here's one of them:</p>
<pre><code>func sendResponse(sending *sync.Mutex, req *Request,
 reply interface{}, enc *gob.Encoder, errmsg string)
</code></pre>
<p>became</p>
<pre><code>func sendResponse(sending *sync.Mutex, req *Request,
  reply interface{}, enc ServerCodec, errmsg string)
</code></pre>
<p>We then wrote a trivial <code>gobServerCodec</code> wrapper to reproduce the original functionality.
From there it is simple to build a <code>jsonServerCodec</code>.</p>
<p>After some similar changes to the client side,
this was the full extent of the work we needed to do on the RPC package.
This whole exercise took about 20 minutes!
After tidying up and testing the new code,
the <a href="https://github.com/golang/go/commit/dcff89057bc0e0d7cb14cf414f2df6f5fb1a41ec" target="_blank" rel="noopener">final changeset</a> was submitted.</p>
<p>In an inheritance-oriented language like Java or C++,
the obvious path would be to generalize the RPC class,
and create JsonRPC and GobRPC subclasses.
However, this approach becomes tricky if you want to make a further generalization
orthogonal to that hierarchy.
(For example, if you were to implement an alternate RPC standard).
In our Go package, we took a route that is both conceptually simpler and
requires less code be written or changed.</p>
<p>A vital quality for any codebase is maintainability.
As needs change, it is essential to adapt your code easily and cleanly,
lest it become unwieldy to work with.
We believe Go's lightweight, composition-oriented type system provides a
means of structuring code that scales.</p>

      
    
  

  </div>

	
		<h2>Related articles</h2>
		<ul>
		
			<li><a href="/protobuf-apiv2">A new Go API for Protocol Buffers</a></li>
		
			<li><a href="/go1.13-errors">Working with Errors in Go 1.13</a></li>
		
			<li><a href="/debug-opt">Debugging what you deploy in Go 1.12</a></li>
		
			<li><a href="/h2push">HTTP/2 Server Push</a></li>
		
			<li><a href="/http-tracing">Introducing HTTP Tracing</a></li>
		
			<li><a href="/generate">Generating code</a></li>
		
			<li><a href="/race-detector">Introducing the Go Race Detector</a></li>
		
			<li><a href="/maps">Go maps in action</a></li>
		
			<li><a href="/gofmt">go fmt your code</a></li>
		
			<li><a href="/organizing-go-code">Organizing Go code</a></li>
		
			<li><a href="/debug-gdb">Debugging Go programs with the GNU Debugger</a></li>
		
			<li><a href="/image-draw">The Go image/draw package</a></li>
		
			<li><a href="/image">The Go image package</a></li>
		
			<li><a href="/laws-of-reflection">The Laws of Reflection</a></li>
		
			<li><a href="/error-handling-and-go">Error handling and Go</a></li>
		
			<li><a href="/functions-codewalk">First Class Functions in Go</a></li>
		
			<li><a href="/pprof">Profiling Go Programs</a></li>
		
			<li><a href="/gif-decoder">A GIF decoder: an exercise in Go interfaces</a></li>
		
			<li><a href="/introducing-gofix">Introducing Gofix</a></li>
		
			<li><a href="/godoc">Godoc: documenting Go code</a></li>
		
			<li><a href="/gob">Gobs of data</a></li>
		
			<li><a href="/cgo">C? Go? Cgo!</a></li>
		
			<li><a href="/json">JSON and Go</a></li>
		
			<li><a href="/slices-intro">Go Slices: usage and internals</a></li>
		
			<li><a href="/concurrency-timeouts">Go Concurrency Patterns: Timing out, moving on</a></li>
		
			<li><a href="/defer-panic-and-recover">Defer, Panic, and Recover</a></li>
		
			<li><a href="/codelab-share">Share Memory By Communicating</a></li>
		
		</ul>
	

      </div>

    </div>
  </main>

  <footer>
    <div class="Footer">
      <img class="Footer-gopher" src="/lib/godoc/images/footer-gopher.jpg" alt="The Go Gopher">
      <ul class="Footer-links">
        <li class="Footer-link"><a href="https://golang.org/doc/copyright.html">Copyright</a></li>
        <li class="Footer-link"><a href="https://golang.org/doc/tos.html">Terms of Service</a></li>
        <li class="Footer-link"><a href="http://www.google.com/intl/en/policies/privacy/">Privacy Policy</a></li>
        <li class="Footer-link"><a href="http://golang.org/issues/new?title=x/blog:" target="_blank" rel="noopener">Report issue</a></li>
      </ul>
      <a class="Footer-supportedBy" href="https://google.com">Supported by Google</a>
    </div>
  </footer>

  <script src="/lib/godoc/jquery.js"></script>
  <script src="/lib/godoc/playground.js"></script>
  <script src="/lib/godoc/play.js"></script>
  <script src="/lib/godoc/godocs.js"></script>
  <script>
  $(function() {
    
    $('.playground > pre.numbers, .code > pre.numbers').each(function() {
      var $spans = $(this).find('> span');

      
      var max = 0;
      $spans.each(function() {
        var n = $(this).attr('num')*1;
        if (n > max) max = n;
      });
      var width = 2;
      while (max > 10) {
        max = max / 10;
        width++;
      }

      
      $spans.each(function() {
        var n = $(this).attr('num')+' ';
        while (n.length < width) n = ' '+n;
        $('<span class="number">').text(n).insertBefore(this);
      });
    });

    initPlayground(new HTTPTransport());
  });
  </script>
